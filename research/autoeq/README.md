# Анализ AutoEq для параметризации эквалайзера

Данный раздел содержит аналитическое исследование датасета **AutoEq**, выполненное в рамках проекта **EarLoop**.  
Цель анализа — выявить устойчивые закономерности в параметрических эквалайзерных коррекциях и использовать их для обоснования структуры и диапазонов параметров эквалайзера.

Анализ носит исследовательский характер и служит основой для последующей реализации генерации синтетических пользовательских профилей и связки нейросети с DSP.

---

## 1. Цели анализа

В рамках анализа AutoEq ставятся следующие задачи:

1. Определить, какие **типы фильтров** используются в параметрических эквалайзерах.
2. Проанализировать распределение:
   - центральных частот (`fc`),
   - усилений (`gain`),
   - параметра `Q`.
3. Выявить **частотные зоны**, в которых коррекции встречаются наиболее часто и имеют наибольшую амплитуду.
4. Обосновать выбор:
   - параметров пользовательского вектора,
   - диапазонов допустимых значений,
   - вероятностной модели генерации параметров.

---

## 2. Описание датасета AutoEq

AutoEq представляет собой набор параметрических эквалайзерных конфигураций, автоматически рассчитанных для различных моделей наушников с целью приведения их АЧХ к целевой кривой.

В анализе используются следующие файлы:

- **`ParametricEQ.txt`**  
  Содержит список параметрических фильтров:
  - `LS` (low-shelf),
  - `PK` (peaking),
  - `HS` (high-shelf),
  с параметрами `fc`, `gain` и `Q`.

- **`GraphicEQ.txt`**  
  Представляет дискретизированную коррекционную кривую на фиксированной логарифмической сетке частот и используется только для анализа формы АЧХ, но не выбора частот управления.

---

## 3. Типы фильтров и их роли

В ходе анализа установлено функциональное разделение фильтров:

### 3.1 Shelving-фильтры (LS / HS)

- Используются для задания **глобального тонального баланса**.
- Имеют фиксированные центральные частоты:
  - LS ≈ 105 Гц,
  - HS ≈ 10 кГц.
- Присутствуют практически в каждой конфигурации.

Shelving-фильтры не отражают локальные частотные особенности и рассматриваются как **якорные параметры**, а не как зоны локальной коррекции.

### 3.2 Peaking-фильтры (PK)

- Используются для **локальной коррекции** АЧХ.
- Центральные частоты варьируются в широком диапазоне (примерно 20 Гц – 10 кГц).
- Именно PK-фильтры отражают реальные зоны проблемных резонансов и тембральных отклонений.

---

## 4. Анализ частотных зон (PK)

Для peaking-фильтров проводится анализ распределения частот и величины коррекций:

- Частоты рассматриваются в логарифмической шкале.
- Используется метрика важности:
  - сумма или среднее `|gain|` в окрестности частоты.

На основе этих данных выполняется кластеризация частот, что позволяет выделить **устойчивые зоны локальной коррекции**, которые интерпретируются как потенциальные параметры управления эквалайзером.

---

## 5. Анализ усилений (gain)

Распределение значений `gain` обладает следующими свойствами:

- Симметрично и центрировано вокруг 0 dB.
- Основная масса значений лежит в узком диапазоне (порядка ±6 dB).
- Экстремальные значения (±15–20 dB) встречаются редко.

Вывод:
- Использование равномерного распределения для генерации `gain` приводит к нереалистичным профилям.
- В качестве априорного распределения используется **эмпирическое распределение**, полученное из данных AutoEq.

---

## 6. Анализ параметра Q

Параметр `Q` определяет **ширину полосы коррекции**:

- Малые значения `Q` соответствуют широким и плавным коррекциям.
- Большие значения `Q` — узким, точечным коррекциям.

Анализ показал, что:
- `Q` статистически зависит от частотного диапазона.
- Распределение `Q` более стабильно и отражает свойства акустики, а не пользовательские предпочтения.

В связи с этим параметр `Q` не включается напрямую в вектор предпочтений пользователя, а задаётся на уровне реализации фильтров в DSP.

---

## 7. Ограничения анализа

При интерпретации результатов необходимо учитывать следующие ограничения:

1. Датасет AutoEq является **алгоритмическим**, а не пользовательским.
2. Peaking-фильтры ограничены диапазоном до **10 кГц**.
3. Частоты выше 10 кГц не представлены как отдельные параметры управления и не могут быть статистически выведены из AutoEq.

Эти ограничения учитываются при проектировании архитектуры параметров.

---

## 8. Итоговые выводы

1. AutoEq позволяет надёжно выявить **частотные зоны локальной коррекции** до 10 кГц.
2. Глобальный тональный баланс корректируется преимущественно shelving-фильтрами с фиксированными частотами.
3. Реалистичная параметризация эквалайзера требует:
   - разделения глобальных и локальных параметров,
   - использования эмпирических распределений,
   - учёта частотной специфики параметра `Q`.
4. Результаты анализа формируют основу для генерации синтетических профилей и проектирования интерфейса управления эквалайзером.

---

## 9. Назначение результатов

Полученные результаты используются для:
- обоснования структуры параметров эквалайзера,
- ограничения диапазонов параметров,
- повышения реалистичности синтетических данных,
- подготовки последующих этапов разработки системы *Neural Controller → DSP*.

---

